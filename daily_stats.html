<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Stats/Data</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        async function fetchData(url, tableId) {
            const response = await fetch(url);
            const data = await response.text();
            const rows = data.split('\n').map(row => row.split(','));

            const tableBody = document.querySelector(`#${tableId} tbody`);
            tableBody.innerHTML = ''; // Clear existing data

            // Define the indices for the required columns
            const headers = rows[0];
            const indices = {
                Jockey: headers.indexOf("Jockey"),
                SevenDayRuns: headers.indexOf("7Day_Runs"),
                SevenDayWins: headers.indexOf("7Day_Wins"),
                SevenDayPlaces: headers.indexOf("7Day_Places"),
                SevenDayWinStrike: headers.indexOf("7Day_Win_Strike"),
                SevenDayPlaceStrike: headers.indexOf("7Day_Place_Strike"),
                SevenDaySPProfitLoss: headers.indexOf("7Day_SP_ProfitLoss"),
                FourteenDayRuns: headers.indexOf("14Day_Runs"),
                FourteenDayWins: headers.indexOf("14Day_Wins"),
                FourteenDayPlaces: headers.indexOf("14Day_Places"),
                FourteenDayWinStrike: headers.indexOf("14Day_Win_Strike"),
                FourteenDayPlaceStrike: headers.indexOf("14Day_Place_Strike"),
                FourteenDaySPProfitLoss: headers.indexOf("14Day_SP_ProfitLoss"),
                OneYearRuns: headers.indexOf("1YR_Runs"),
                OneYearWins: headers.indexOf("1YR_Wins"),
                OneYearPlaces: headers.indexOf("1YR_Places"),
                OneYearWinStrike: headers.indexOf("1YR_Win_Strike"),
                OneYearPlaceStrike: headers.indexOf("1YR_Place_Strike"),
                OneYearSPProfitLoss: headers.indexOf("1YR_SP_ProfitLoss"),
            };

            // Filter and sort the data based on 14Day_Place_Strike
            const filteredRows = rows.slice(1).map(row => ({
                Jockey: row[indices.Jockey],
                SevenDayRuns: row[indices.SevenDayRuns],
                SevenDayWins: row[indices.SevenDayWins],
                SevenDayPlaces: row[indices.SevenDayPlaces],
                SevenDayWinStrike: row[indices.SevenDayWinStrike],
                SevenDayPlaceStrike: row[indices.SevenDayPlaceStrike],
                SevenDaySPProfitLoss: row[indices.SevenDaySPProfitLoss],
                FourteenDayRuns: row[indices.FourteenDayRuns],
                FourteenDayWins: row[indices.FourteenDayWins],
                FourteenDayPlaces: row[indices.FourteenDayPlaces],
                FourteenDayWinStrike: row[indices.FourteenDayWinStrike],
                FourteenDayPlaceStrike: row[indices.FourteenDayPlaceStrike],
                FourteenDaySPProfitLoss: row[indices.FourteenDaySPProfitLoss],
                OneYearRuns: row[indices.OneYearRuns],
                OneYearWins: row[indices.OneYearWins],
                OneYearPlaces: row[indices.OneYearPlaces],
                OneYearWinStrike: row[indices.OneYearWinStrike],
                OneYearPlaceStrike: row[indices.OneYearPlaceStrike],
                OneYearSPProfitLoss: row[indices.OneYearSPProfitLoss],
            }));

            const sortedRows = filteredRows.sort((a, b) => b.FourteenDayPlaceStrike - a.FourteenDayPlaceStrike);

            // Populate the table with sorted data
            sortedRows.forEach(row => {
                const tr = document.createElement('tr');
                for (const key in row) {
                    const td = document.createElement('td');
                    td.textContent = row[key];
                    tr.appendChild(td);
                }
                tableBody.appendChild(tr);
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            const jockeyDataUrl = 'https://docs.google.com/spreadsheets/d/1o404gnNxauWQjXDnMDHng3fUGe3U0HTx750AKPH8PXc/export?format=csv'; // Your CSV URL

            fetchData(jockeyDataUrl, 'jockeyData');
        });
    </script>
</head>
<body>
    <header>
        <h1>Daily Stats/Data</h1>
        <button class="back" onclick="window.history.back();">Back</button>
    </header>
    <main>
        <section class="stats-section">
            <h2>Jockey</h2>
            <table id="jockeyData">
                <thead>
                    <tr>
                        <th>Jockey</th>
                        <th>7 Day Runs</th>
                        <th>7 Day Wins</th>
                        <th>7 Day Places</th>
                        <th>7 Day Win Strike</th>
                        <th>7 Day Place Strike</th>
                        <th>7 Day SP Profit/Loss</th>
                        <th>14 Day Runs</th>
                        <th>14 Day Wins</th>
                        <th>14 Day Places</th>
                        <th>14 Day Win Strike</th>
                        <th>14 Day Place Strike</th>
                        <th>14 Day SP Profit/Loss</th>
                        <th>1 Year Runs</th>
                        <th>1 Year Wins</th>
                        <th>1 Year Places</th>
                        <th>1 Year Win Strike</th>
                        <th>1 Year Place Strike</th>
                        <th>1 Year SP Profit/Loss</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </section>

        <section class="stats-section">
            <h2>Trainer</h2>
            <table id="trainerData">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Race Time</th>
                        <th>Track</th>
                        <th>Horse Name</th>
                        <th>Performance Rating</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </section>

        <section class="stats-section">
            <h2>Trainer Jockey Combo</h2>
            <table id="comboData">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Race Time</th>
                        <th>Track</th>
                        <th>Horse Name</th>
                        <th>Performance Rating</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Horse Racing Ratings</p>
    </footer>
</body>
</html>
